{% extends "layout2.html" %}
{% block title %}Summarization{% endblock %}

{% block content %}
<h1>Summarization</h1>

<form id="summary-form" method="POST" action="{% url 'ask_me:summary' %}">
    {% csrf_token %}
    <div class="form-flex-sum">
        <p class="comment">Please input cybersecurity-related paragraph or articles:</p>
        <textarea id="paragraph" name="paragraph" rows="14" class="form-control" placeholder="Type or paste your paragraph here..." required>{% if paragraph %}{{ paragraph }}{% endif %}</textarea>
        <button type="submit" class="btn btn-primary">Generate Summary</button>
    </div>
</form>
<br>

<div id="loading-section" class="loading-container" style="display:none;">
    <div class="loading-box">
        <div class="loading-top">
            <h3>Generating Summary<span id="loading-dots">...</span></h3>
        </div>
        <div class="loader"></div>
    </div>
</div>

{% if summary %}
    <hr><br>
    <h3>Generated Summary:</h3>
    <form method="POST" action="{% url 'ask_me:summary' %}">
        {% csrf_token %}

        <div class="response-block">
            <p id="summary-text"></p>
        </div>
        
        <input type="hidden" name="paragraph" value="{{ paragraph }}">
        
        <!-- Button Container -->
        <div class="button-wrapper">
            <button type="submit" class="btn btn-secondary">Generate Summary Again</button>
            <button type="button" class="btn btn-success" id="translate-btn">Translate into Chinese</button>
        </div>
    </form><br>
{% endif %}

<style>
    /* 通用 Flexbox 佈局 */
    .button-wrapper {
        display: flex;
        justify-content: space-between;
        gap: 10px;
    }

    /* 在視窗小於 768px 時，按鈕上下排列 */
    @media (max-width: 768px) {
        .button-wrapper {
            flex-direction: column;
            align-items: stretch;
        }
        .button-wrapper button {
            margin-bottom: 10px; /* 讓按鈕之間有間距 */
        }
    }
</style>

<script>
    const form = document.getElementById('summary-form');
    const loadingSection = document.getElementById('loading-section');
    const summaryText = document.getElementById('summary-text');

    form.addEventListener('submit', function() {
        loadingSection.style.display = 'flex';
    });

    function displayWordByWord(text, elementId) {
        const element = document.getElementById(elementId);
        const words = text.split(" ");
        let index = 0;

        element.textContent = "";

        const interval = setInterval(() => {
            if (index < words.length) {
                element.textContent += words[index] + " ";
                index++;
            } else {
                clearInterval(interval); 
            }
        }, 200); 
    }

    document.addEventListener("DOMContentLoaded", () => {
        const summary = "{{ summary|escapejs }}";
        if (summary) {
            displayWordByWord(summary, "summary-text");
        }
    });
</script>
{% endblock %}
